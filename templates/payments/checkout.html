{% extends "base.html" %}
{% block content %}

<div class="container mt-5">
    <div class="card p-4 shadow mx-auto" style="max-width:500px;">
        <h4 class="text-center mb-3">Payment Checkout</h4>

        <p><strong>Service:</strong> {{ booking.service.s_name }}</p>
        <p><strong>Amount:</strong> ₹{{ amount }}</p>

        <button id="pay-btn" class="btn btn-success btn-block">
            Pay ₹{{ amount }}
        </button>
    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ amount }}00",
        "currency": "INR",
        "name": "Powerfix Services",
        "description": "Service Payment",
        "order_id": "{{ order_id }}",

        "handler": function (response) {

            fetch("{% url 'payments:payment_success' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify(response)
            })
                .then(() => {
                    // ✅ FINAL REDIRECT
                    window.location.href = "{% url 'customer_invoice' booking.id %}";
                });
        },

        "theme": {
            "color": "#ffc107"
        }
    };

    document.getElementById("pay-btn").onclick = function () {
        var rzp = new Razorpay(options);
        rzp.open();
    };
</script>

{% endblock %}